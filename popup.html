<html>
  <head>
    <title>Dash</title>

    <script src="javascript/sha1.js" type="text/javascript"></script>
    <script src="javascript/base64.js" type="text/javascript"></script>
    <script type="text/javascript">
      var STRONG = 'ABCDEFGHJKLMNPQRSTUVWabcdefghijkmnopqrstuvw0123456789+/-_*()[]{}';
      var WEAK =  'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      var LENGTH = 12;
  
      function hash() {
        var password = document.getElementById("password").value;
        var domain = document.getElementById("domain").value;
        
        var key = encrypt(password);
        var hash = encrypt(key + domain);

        hash = base64_encode(hash, STRONG);
        hash = hash.substring(0, LENGTH);

        document.getElementById("hash").innerHTML = hash;
      }
      
      function encrypt(data) {
        return hex_sha1(data);
      }

      function getDomain(url) {
        var current_URL = '';
        if (url.indexOf('?') > -1) {
        	current_URL = unescape(url.substr(url.indexOf('?')+1));
        }

        if (current_URL == 'localhost')
          return current_URL;
        if (IsIp(current_URL)) 
          return current_URL;
        if (current_URL == '')
          return current_URL;

        var split = current_URL.split('.'); //location.hostname.split('.');
        var domain = [split.pop()];
        var item;

        while (item = split.pop()) {
          domain.unshift(item);
          if (item.length > 2) {
            break;
          }
        }
        return domain.join('.');
      }

      function IsIp(ip) {
        var regexp = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/
        return regexp.test(ip);
      }
      
      chrome.tabs.getSelected(null, function(tab) {
          document.getElementById("domain").value = tab.url;
          hash();
      });
    </script>
  </head>
  <body>
    <form action="#" onsubmit="hash(); return false" method="get">
      Master password: <input class="dynamic" type="password" id="password" />
      Domain: <input class="dynamic" type="text" id="domain" />
      <input type="submit" value="Go"/>
    </form>
    <span id="hash" style="color: #0000ff; font-weight: bold"/></span>          
  </body>
</html>
