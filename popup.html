<html>
  <head>
    <title>Dash</title>

    <script src="javascript/sha1.js" type="text/javascript"></script>
    <script src="javascript/base64.js" type="text/javascript"></script>
    <script type="text/javascript">
      var STRONG = 'ABCDEFGHJKLMNPQRSTUVWabcdefghijkmnopqrstuvw0123456789+/-_*()[]{}';
      var WEAK =  'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      var LENGTH = 12;

      function hash() {
        var password = document.getElementById("password").value;
        var domain = document.getElementById("domain").value;

        var key = encrypt(password);
        var hash = encrypt(key + domain);

        hash = base64_encode(hash, STRONG);
        hash = hash.substring(0, LENGTH);

        document.getElementById("hash").innerHTML = hash;
      }

      function encrypt(data) {
        return hex_sha1(data);
      }

      function getHostname(url) {
        var l = document.createElement("a");
        l.href = url;
        document.getElementById("domain").value = l.hostname;
      }

      chrome.tabs.getSelected(null, function(tab) {
        getHostname(tab.url);
      });
      
      function onLoad() { }
      function onUnload() { }
    </script>
  </head>
  <body onload="onLoad()" onunload="onUnload()>
    <form action="#" onsubmit="hash(); return false" method="get">
      Master password: <input class="dynamic" type="password" id="password" />
      Domain: <input class="dynamic" type="text" id="domain" />
      <input type="submit" value="Go"/>
    </form>
    <span id="hash" style="color: #0000ff; font-weight: bold"/></span>          
  </body>
</html>
